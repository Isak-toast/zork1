# 2025-12-05 게임 개발 문서 (Zork Web)

## 1. 프로젝트 개요
**Zork Web**은 고전 텍스트 어드벤처 게임인 **Zork I**을 웹 브라우저에서 즐길 수 있도록 현대적으로 재해석한 프로젝트입니다. 원작의 텍스트 기반 플레이를 유지하면서, 그래픽 인터페이스, 자동 지도 매핑, 편의성 기능(단축키, 자동 이동)을 추가하여 사용자 경험을 향상시켰습니다.

## 2. 기술 스택
*   **Core**: React (v18), TypeScript
*   **Build Tool**: Vite
*   **Interpreter**: JSZM (JavaScript Z-Machine Interpreter)
*   **Styling**: CSS (Pixel art style, Retro terminal look)
*   **State Management**: React `useState`, `useRef`

## 3. 시스템 아키텍처

### 3.1. 디렉토리 구조
```
src/
├── components/       # UI 컴포넌트
│   ├── GameTerminal.tsx  # 텍스트 입출력 터미널
│   ├── GameGraphics.tsx  # 장소별 이미지 표시
│   ├── GameControls.tsx  # 하단 컨트롤 패널 (인벤토리, 단축키)
│   └── GameSidebar.tsx   # 사이드바 (네비게이션, 지도 정보)
├── utils/
│   └── ZorkMap.ts        # 맵 데이터 및 경로 탐색 알고리즘
├── App.tsx           # 메인 게임 루프 및 상태 관리
├── jszm.js           # Z-Machine 인터프리터 엔진
└── main.tsx          # 진입점
```

### 3.2. 핵심 모듈 분석

#### **App.tsx (메인 컨트롤러)**
게임의 중앙 제어 장치로, 다음과 같은 역할을 수행합니다.
*   **게임 루프**: `JSZM` 엔진을 초기화하고 `run()` 제너레이터를 통해 게임을 진행합니다.
*   **입출력 관리**: `jszm.print`로 텍스트를 받아 `output` 상태에 저장하고, `jszm.read`로 사용자 입력을 엔진에 전달합니다.
*   **상태 추적**:
    *   `location`: 현재 텍스트 출력을 파싱하여 플레이어의 위치를 추적합니다 (`checkForLocation`).
    *   `inventory`: "Taken." 메시지나 "You are carrying:" 출력을 파싱하여 인벤토리 상태를 업데이트합니다.
*   **매크로 실행**: `runDevScript`를 통해 미리 정의된 명령어 시퀀스(예: 램프 얻기, 지하실 가기)를 실행합니다.

#### **JSZM (Z-Machine Interpreter)**
`zork1.z3` 바이너리 파일을 로드하여 실행하는 핵심 엔진입니다. `App.tsx`와 제너레이터 패턴(`yield`)을 통해 비동기적으로 통신합니다.

#### **utils/ZorkMap.ts (맵 시스템)**
Zork I의 방대한 맵 데이터를 그래프 형태로 구조화했습니다.
*   **데이터 구조**:
    ```typescript
    interface Edge {
        to: string;       // 이동할 장소 이름
        dir: Direction;   // 이동 방향 (n, s, e, w, ...)
        command?: string; // 이동 시 실행할 실제 명령어 (예: "open window\nenter")
        condition?: string; // 이동 조건 (예: "Trapdoor closed")
        isLocked?: boolean; // 잠금 상태
    }
    ```
*   **경로 탐색**: `findPath(start, end)` 함수는 BFS(너비 우선 탐색) 알고리즘을 사용하여 현재 위치에서 목표 위치까지의 최단 경로와 명령어 목록을 반환합니다. 이는 "자동 이동" 기능의 핵심입니다.

#### **components/GameGraphics.tsx (그래픽 엔진)**
현재 `location` 상태에 따라 적절한 이미지를 렌더링합니다.
*   `locationImages` 객체에 장소 이름과 이미지 경로를 매핑합니다.
*   이미지가 없는 경우, SVG로 생성된 픽셀 아트 스타일의 플레이스홀더를 표시합니다.

## 4. 주요 기능 상세

### 4.1. 위치 추적 시스템 (Location Tracking)
Z-Machine은 본질적으로 현재 "장소 이름"을 명시적으로 내뱉지 않습니다. 따라서 `App.tsx`의 `checkForLocation` 함수가 출력된 텍스트 스트림을 감시하며, 사전에 정의된 장소 목록(`locations` 배열)과 일치하는 텍스트가 있는지 확인하여 현재 위치를 갱신합니다. 또한 상태 표시줄(Status Line)의 텍스트도 파싱하여 정확도를 높입니다.

### 4.2. 자동 네비게이션 (Auto-Navigation)
사용자가 사이드바에서 이동하고 싶은 인접 장소를 클릭하면, `handleNavigate` 함수가 호출됩니다. 이 함수는 `ZorkMap`의 `findPath`를 통해 경로를 계산하고, 필요한 명령어들을 `commandQueue`에 넣어 순차적으로 실행합니다. 복잡한 이동(예: "양탄자 움직이고 트랩도어 열고 아래로")도 하나의 액션으로 처리됩니다.

### 4.3. 인벤토리 동기화
게임 내 인벤토리 명령(`i`)을 주기적으로 실행하거나, 아이템 획득 메시지("Taken.")를 감지하여 UI의 인벤토리 목록을 게임 내부 상태와 동기화합니다.

## 5. 향후 개발 계획 (Roadmap)

1.  **이미지 리소스 확충**: 현재 플레이스홀더로 대체된 장소들의 픽셀 아트 이미지 제작 및 적용.
2.  **맵 데이터 고도화**: `ZorkMap.ts`에 누락된 장소 및 연결 관계 보완 (특히 미로 구역 및 후반부 지역).
3.  **저장/불러오기 UI**: JSZM의 세이브 기능을 활용하여 브라우저 로컬 스토리지에 게임 진행 상황 저장 기능 구현.
4.  **모바일 최적화**: 터치 인터페이스에 최적화된 가상 키패드 및 레이아웃 조정.
5.  **사운드 효과**: 장소별 배경음악(BGM) 및 효과음(SFX) 추가.

---
*작성일: 2025년 12월 5일*
*작성자: AI Assistant (Antigravity)*
